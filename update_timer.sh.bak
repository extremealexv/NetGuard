#!/bin/bash

# This script updates the Netureon scan timer
# It should be called with the interval in seconds as the first argument

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <interval_seconds>"
    exit 1
fi

INTERVAL=$1

# Create timer unit file
cat > /etc/systemd/system/netureon_scan.timer << EOL
[Unit]
Description=Netureon Network Scanner Timer
Documentation=https://github.com/extremealexv/Netureon

[Timer]
OnBootSec=60
OnUnitActiveSec=${INTERVAL}s
# Randomize start time within 60s to prevent resource spikes
RandomizedDelaySec=60
# Ensure timer is persistent across reboots
Persistent=true
AccuracySec=1s

[Install]
WantedBy=timers.target
EOL

# Set correct permissions
chmod 644 /etc/systemd/system/netureon_scan.timer

# Reload systemd and restart timer
systemctl daemon-reload
systemctl restart netureon_scan.timer

echo "Timer updated successfully"
